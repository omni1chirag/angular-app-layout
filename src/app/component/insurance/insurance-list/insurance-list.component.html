<div class="card mt-5">

    <span class="flex items-center gap-2 w-full justify-between">
        <h4 class="text-base/7 font-semibold"> {{'INSURANCE.INSURANCE' | translate}}</h4>
        <p-button label="{{'ADD' | translate}}" size="small" class="mr-3" severity="primary" [disabled]="!patientId()"
            (onClick)="addInsurance()"></p-button>

    </span>
    <p-divider />
    <p-table [value]="insurances" [paginator]="true" styleClass="mt-2" [totalRecords]="totalRecords" [first]="first"
        [rows]="size" (onLazyLoad)="initializeInsuraces()" [loading]="showLoader" [lazy]="true" size="small"
        rowGroupMode="subheader" stripedRows #insuranceTable>
        <ng-template #header>
            <tr>
                <th scope="col" style="width:14%">{{'INSURANCE.INSURANCE_PROVIDER_NAME' | translate}}</th>
                <th scope="col" style="width:10%">{{'INSURANCE.POLICY_NUMBER' | translate}}</th>
                <th scope="col" style="width:8%">{{'INSURANCE.POLICY_START_DATE' | translate}}</th>
                <th scope="col" style="width:8%">{{'INSURANCE.POLICY_EXPIRY_DATE' | translate}}</th>
                <th scope="col" style="width:5%">{{'STATUS' | translate}}</th>
                <th scope="col" style="width:5%; text-align: center;">{{'ACTIONS' | translate}}</th>
            </tr>
        </ng-template>
        <ng-template #body let-insurance let-index="rowIndex">
            <tr>
                <td>
                    {{ insurance.insuranceProviderName }}
                </td>
                <td>
                    {{ insurance.policyNumber }}
                </td>
                <td>
                    {{ insurance.policyStartDate | date: 'dd/MM/yyyy' }}
                </td>
                <td>
                    {{ insurance.policyExpiryDate | date: 'dd/MM/yyyy' }}
                </td>
                <td>
                    <p-tag [severity]="insurance.status === 1 ? 'success' : 'danger'"
                        [value]="insurance.status === 1 ? 'Active':'Inactive'">
                    </p-tag>
                </td>
                <td class="flex justify-center">
                    <p-menu #menu [popup]="true" [model]="optionsItems" appendTo="body">
                        <ng-template #item let-item>
                            <ng-container *ngIf="item.label ==='EDIT' ; else elseBlock">
                                <button class="p-menu-item-link w-full"
                                    (click)="editInsurance(insurance.patientInsuranceId)">
                                    <span [class]="item.icon"></span>
                                    <span class="ml-2">{{ item.label | translate }}</span>
                                </button>
                            </ng-container>
                            <ng-template #elseBlock>
                                <button class="p-menu-item-link w-full"
                                    (click)="updateStatus(insurance.patientInsuranceId,insurance.status === 1 ? 0 : 1)">
                                    <span
                                        [class]="insurance.status === 1 ? 'pi pi-times-circle': 'pi pi-check-circle' "></span>
                                    <span class="ml-2">{{ (insurance.status === 1 ? 'DE_ACTIVATE':
                                        'ACTIVATE')
                                        | translate}}</span>
                                </button>
                            </ng-template>
                        </ng-template>
                    </p-menu>
                    <div class="flex justify-center">
                        <p-button icon="pi pi-ellipsis-v" severity="secondary" rounded (onClick)="menu.toggle($event)"
                            [raised]="true" />
                    </div>
                </td>
            </tr>
        </ng-template>
        <ng-template #emptymessage>
            <tr>
                <td colspan="6" style="text-align:center;">
                    <span>{{ 'NO_DATA_FOUND' | translate }}</span>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>

@if(visible() && patientId()) {
<app-insurance-add-edit [(isVisible)]="visible" (insuranceSaved)="initializeInsuraces()" [patientId]="patientId()"
    [patientInsuranceId]="patientInsuranceId"></app-insurance-add-edit>
}