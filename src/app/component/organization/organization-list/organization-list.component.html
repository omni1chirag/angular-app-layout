<div pageHeader="list">
    <p-toolbar>
        <ng-template #start>
            <div class="flex items-center gap-2">
                <div class="text-2xl font-bold sm:truncate sm:text-3xl sm:tracking-tight">Organization List</div>

            </div>
        </ng-template>

        <ng-template #end>
            <div class="flex items-center gap-2">
                <p-button label="Add Organization" (onClick)="navigateTo('/home/organization/add')" />
            </div>
        </ng-template>
    </p-toolbar>
</div>

<div class="card">
    <div class="flex justify-between table-options">
        <div class="flex items-center gap-2">
            <button pButton label="Clear" class="p-button-outlined" icon="pi pi-filter-slash"
                (click)="clear(organizationTable)"></button>
        </div>
    </div>
    <p-divider></p-divider>

    <p-table [value]="organizations" [paginator]="true" [rows]="size" [totalRecords]="totalRecords"
        [loading]="showLoader"  [(selection)]="selectedOrganzation" size="small" [scrollable]="true" [first]="first"
        [lazy]="true" (selectionChange)="onSelectionChange()" (onLazyLoad)="loadOrganziations($event)"
        [sortField]="defaultSortField" [sortOrder]="defaultSortOrder" tableAutoScroll stripedRows #organizationTable>
        <ng-template #header>
            <tr>
                <th style="min-width:200px" class="font-bold" pFrozenColumn [frozen]="freezeOrganizationName" [width]="'32%'"
                    [ngClass]="{ 'font-bold': freezeOrganizationName }" alignFrozen="left">
                    Organization Name 
                    <!-- <p-sortIcon field="organizationName" /> -->
                </th>
                <th class="font-bold"  [width]="'21%'">
                    Subscription Plan
                </th>
                <th style="min-width:200px"  [width]="'15%'">State</th>
                <th style="min-width:200px"  [width]="'15%'">City</th>
                <th style="min-width:200px"  [width]="'15%'">Status</th>
                <th style="min-width:100px; text-align: center;" alignFrozen="right" pFrozenColumn  [width]="'8%'"
                    [frozen]="freezeActions" [ngClass]="{ 'font-bold': freezeActions }" *ngIf="isBrowser">Actions</th>
            </tr>
            <tr>
                <th pFrozenColumn [frozen]="freezeOrganizationName" [ngClass]="{ 'font-bold': freezeOrganizationName }"
                    alignFrozen="left">
                    <p-columnFilter type="text" field="organizationName" placeholder="Search by OrganizationName"
                        [showMenu]="false" ariaLabel="Filter Organization"  [showClearButton]="false">
                        <ng-template #filter let-value let-filter="filterCallback">
                            <p-autoComplete dropdown id="organizationName" [ngModel]="value" inputStyleClass="w-full"
                                [suggestions]="organizationSuggestions" optionLabel="label" optionValue="value"
                                placeholder="Search Organization Name" [dropdown]="false" [minLength]="3"
                                [forceSelection]="true" (onClear)="filter(undefined)"
                                (onSelect)="filter($event.value.value)" (completeMethod)="searchOrganizations($event)"
                                appendTo="body" />
                        </ng-template>
                    </p-columnFilter>
                </th>

                <th>
                    <p-columnFilter field="subscriptionPlanName" [showMenu]="false"  [showClearButton]="false">
                        <ng-template #filter let-value let-filter="filterCallback">
                            <p-multiselect dropdown [options]="subscriptionPlanOptions" id="subscriptionPlanName"
                                placeholder="Select Subscription Plan" optionLabel="planName" [ngModel]="value"
                                optionValue="subscriptionPlanId" display="chip" [filter]="true"
                                (onChange)="filter($event.value)"  appendTo="body" [style]="{'min-width': '200px'}"
                                [maxSelectedLabels]="1" selectedItemsLabel="{0} items selected"  [display]="'comma'"/>

                        </ng-template>
                    </p-columnFilter>
                </th>
                <th></th>
                <th></th>
                <th>
                    <p-columnFilter field="status" matchMode="equals" [showMenu]="false"  [showClearButton]="false">
                        <ng-template #filter let-value let-filter="filterCallback">
                            <p-select [ngModel]="value" [options]="statusList" (onChange)="filter($event.value)"
                                placeholder="Select Status" [style]="{ 'min-width': '12rem' }" appendTo="body">
                                <ng-template let-option #item>
                                    <div class="flex justify-center gap-2">
                                        <p-tag [value]="option.label" [severity]="getSeverity(option.value)" />
                                    </div>
                                </ng-template>
                            </p-select>
                        </ng-template>
                    </p-columnFilter>
                </th>
                <th pFrozenColumn alignFrozen="right" [frozen]="freezeActions" style="text-align: center;">
                    <p-togglebutton [(ngModel)]="freezeActions" [onIcon]="'pi pi-lock'" offIcon="pi pi-lock-open"
                        [onLabel]="'Unlock'" offLabel="Lock" />
                </th>
            </tr>
        </ng-template>
        <ng-template #body let-organization>
            <tr>
                <td class="font-bold" pFrozenColumn [frozen]="freezeOrganizationName"
                    [ngClass]="{ 'font-bold': freezeOrganizationName }">
                    {{ organization.organizationName }}
                    <!-- <p-button label="{{ organization.organizationName }}" [link]="true"
                        (onClick)="editOrganization(organization.organizationId)" /> -->
                </td>
                <!-- <td>{{ organization.typeOfOrganization }}</td> -->
                <td>{{ organization.subscriptionPlanName }}</td>
                <td>{{organization.state}}</td>
                <td>{{organization.city}}</td>
                <td>
                    <span class="flex">
                        <p-tag [severity]="organization.organizationStatus === 'ACTIVE' ? 'success' : 'danger'"
                            [value]="organization.organizationStatus">
                        </p-tag>
                    </span>
                </td>
                <td alignFrozen="right" pFrozenColumn [frozen]="freezeActions"
                    [ngClass]="{ 'font-bold': freezeActions }" *ngIf="isBrowser">
                    <p-menu #menu [popup]="true" [model]="actionsItems" appendTo="body">
                        <ng-template #item let-item>
                            <ng-container *ngIf="item.label =='Edit' ; else elseBlock">
                                <span class="p-menu-item-link" (click)="editOrganization(organization.organizationId)">
                                    <span [class]="item.icon"></span>
                                    <span class="ml-2">{{ item.label }}</span>
                                </span>
                            </ng-container>
                            <ng-container *ngIf="item.label =='Add Clinic' ;">
                                <span class="p-menu-item-link" (click)="addPractice(organization.organizationId)">
                                    <span [class]="item.icon"></span>
                                    <span class="ml-2">{{ item.label }}</span>
                                </span>
                            </ng-container>


                            <ng-template #elseBlock>
                                <span class="p-menu-item-link" 
                                    *ngIf="organization.organizationStatus == 'ACTIVE' && item.label == 'Deactivate'" 
                                    (click)="updateStatus(organization.organizationId, 'INACTIVE')">
                                    <span [class]="item.icon"></span>
                                    <span class="ml-2">{{ item.label }}</span>
                                </span>
                                <span class="p-menu-item-link"  
                                    *ngIf="organization.organizationStatus == 'INACTIVE' && item.label == 'Activate'"
                                    (click)="updateStatus(organization.organizationId, 'ACTIVE')">
                                    <span [class]="item.icon"></span>
                                    <span class="ml-2">{{ item.label }}</span>
                                </span>

                            </ng-template>
                        </ng-template>
                    </p-menu>
                    <div class="flex justify-center">
                        <p-button icon="pi  pi-ellipsis-v" severity="secondary" rounded (click)="menu.toggle($event)"
                            [raised]="true" />
                    </div>
                </td>
            </tr>
        </ng-template>
        <ng-template #emptymessage>
            <tr>
                <td colspan="6" style="text-align:center;">
                    <span>No Data Found.</span>
                </td>
            </tr>
        </ng-template>
    </p-table>
</div>