<ng-container>
    <div class="card">
        <span class="flex items-center gap-2 w-full justify-between">
            <h4 class="text-base/7 font-semibold"> {{'INSURANCE.INSURANCE' | translate}}</h4>
            <p-button label="{{'ADD' | translate}}" size="small" class="mr-3" severity="primary"
            (onClick)="addEditPatientInsurance()"></p-button>

        </span>
        <p-divider />
        <div id="card-shadow">
            <div class="card">
                <p-table [value]="patientInsurances" size="small">
                    <ng-template #header>
                        <tr>
                            <th style="width:14%">{{'INSURANCE.INSURANCE_PROVIDER_NAME' | translate}}</th>
                            <th style="width:10%">{{'INSURANCE.POLICY_NUMBER' | translate}}</th>
                            <th style="width:8%">{{'INSURANCE.POLICY_START_DATE' | translate}}</th>
                            <th style="width:8%">{{'INSURANCE.POLICY_EXPIRY_DATE' | translate}}</th>
                            <th style="width:5%">{{'STATUS' | translate}}</th>
                            <th style="width:5%; text-align: center;">{{'ACTIONS' | translate}}</th>
                        </tr>
                    </ng-template>
                    <ng-template #body let-insurance let-index="rowIndex">
                        <tr>
                            <td>
                                {{ insurance.insuranceProviderName }}
                            </td>
                            <td>
                                {{ insurance.policyNumber }}
                            </td>
                            <td>
                                {{ insurance.policyStartDate | date: 'dd/MM/yyyy' }}
                            </td>
                            <td>
                                {{ insurance.policyExpiryDate | date: 'dd/MM/yyyy' }}
                            </td>
                            <td>
                                <p-tag [severity]="insurance.status === 1 ? 'success' : 'danger'"
                                    [value]="insurance.status == 1 ? 'Active':'Inactive'">
                                </p-tag>
                            </td>
                            <td class="flex justify-center">
                                <p-menu #menu [popup]="true" [model]="optionsItems" appendTo="body">
                                    <ng-template #item let-item>
                                        <ng-container *ngIf="item.label =='EDIT' ; else elseBlock">
                                            <span class="p-menu-item-link"
                                                (click)="addEditPatientInsurance(insurance.patientInsuranceId)">
                                                <span [class]="item.icon"></span>
                                                <span class="ml-2">{{ item.label | translate }}</span>
                                            </span>
                                        </ng-container>
                                        <ng-template #elseBlock>
                                            <span class="p-menu-item-link"
                                                (click)="updateStatus(insurance.patientInsuranceId,insurance.status == 1 ? 0 : 1)">
                                                <span
                                                    [class]="insurance.status == 1 ? 'pi pi-times-circle': 'pi pi-check-circle' "></span>
                                                <span class="ml-2">{{ (insurance.status == 1 ? 'DE_ACTIVATE':
                                                    'ACTIVATE')
                                                    | translate}}</span>
                                            </span>
                                        </ng-template>
                                    </ng-template>
                                </p-menu>
                                <div class="flex justify-center">
                                    <p-button icon="pi  pi-ellipsis-v" severity="secondary" rounded
                                        (click)="menu.toggle($event)" [raised]="true" />
                                </div>
                            </td>
                        </tr>
                    </ng-template>
                    <ng-template #emptymessage>
                        <tr>
                            <td colspan="6" style="text-align:center;">
                                <span>{{ 'NO_DATA_FOUND' | translate }}</span>
                            </td>
                        </tr>
                    </ng-template>
                </p-table>
            </div>
        </div>
    </div>
</ng-container>

<app-patient-insurance-add-edit *ngIf="isPatientInsuranceVisible" [patientInsuranceId]="patientInsuranceId"
    (onInsuranceUpdate)="loadPatientInsurances($event)"
    [(isVisible)]="isPatientInsuranceVisible"></app-patient-insurance-add-edit>