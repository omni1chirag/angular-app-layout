<div class="card">
    <div class="flex justify-between items-center mb-3">
        <h4 class="text-base/7 font-semibold ">{{'SURGICAL_HISTORY.SURGICAL_HISTORY' | translate}}</h4>
        <p-button *ngIf="isModifiable()" label="{{'ADD' | translate}}" size="small" class="mr-3" severity="primary"
            (onClick)="addSurgicalHistory()" [disabled]="signOff() === 1"></p-button>
    </div>
    <p-divider />
    <ng-container>
        @if (isBrowser) {
        <p-table [value]="surgicalHistory" [totalRecords]="totalRecords" [paginator]="true" [loading]="showLoader"
            [first]="first" [lazy]="true" [rows]="size" (onLazyLoad)="loadSurgicalHistory($event)" [scrollable]="true"
            #surgicalHistoryTable>
            <ng-template pTemplate="header">
                <tr>
                    <th scope="col">{{'SURGICAL_HISTORY.SURGERY_NAME' | translate}}</th>
                    <th scope="col">{{'SURGICAL_HISTORY.SURGERY_TYPE' | translate}}</th>
                    <th scope="col">{{'SURGICAL_HISTORY.SURGERY_DATE' | translate}}</th>
                    <th scope="col">{{'SURGICAL_HISTORY.HOSPITAL_NAME' | translate}}</th>
                    <th scope="col">{{'SURGICAL_HISTORY.STATUS' | translate}}</th>
                    <th scope="col">{{'SURGICAL_HISTORY.NOTES' | translate}}</th>
                    <th scope="col">{{'SURGICAL_HISTORY.ACTION' | translate}}
                    </th>
                </tr>
            </ng-template>
            <ng-template pTemplate="body" let-history>
                <tr>
                    <td>{{history.surgeryName}}</td>
                    <td>{{history.surgeryType}}</td>
                    <td>{{history.surgeryDate | date: 'dd/MM/yyyy'}}</td>
                    <td>{{history.hospitalName}}</td>
                    <td>{{history.status}}</td>
                    <td>{{history.notes}}</td>
                    <td *ngIf="isModifiable()">
                        @if (history.isEditable && !history.appointmentSignOff) {
                        <p-button icon="pi pi-pencil" variant="outlined" severity="info" [raised]="false"
                            (onClick)="editSurgicalHistory(history.surgicalHistoryId)" [rounded]="true" />
                        } @else {
                        <p-button icon="pi pi-pencil" variant="outlined" severity="info" [raised]="false"
                            [rounded]="true" [disabled]="!history.isEditable || history.appointmentSignOff === 1"
                            [pTooltip]="!history.isEditable ? ('TOOLTIP.NOT_AUTHORIZED' | translate) : (history.appointmentSignOff === 1 ? ('TOOLTIP.LOCKED_CHART' | translate) : null)"
                            tooltipPosition="top" />
                        }
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="7" style="text-align:center;">
                        <span>{{ 'SURGICAL_HISTORY.TABLE.EMPTY_MESSAGE' | translate }}</span>
                    </td>
                </tr>
            </ng-template>
        </p-table>
        }
    </ng-container>
</div>

<app-surgical-history-add-edit *ngIf="visible" [(isVisible)]="visible" [surgicalHistoryId]="surgicalHistoryId"
    [patientId]="patientId()" [appointmentId]="appointmentId()"
    (surgicalHistoryUpdate)="surgicalHistoryTable.clear()"></app-surgical-history-add-edit>