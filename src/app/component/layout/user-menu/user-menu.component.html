<p-drawer [(visible)]="layoutService.layoutState().userMenuVisible" header="User Profile" position="right"
    (onHide)="hideUserMenu()" blockScroll="true">
    <div class="flex flex-col h-full">
        <p-panelmenu [model]="topItems()" [multiple]="true" styleClass="w-full md:w-20rem">
            <ng-template #item let-item>
                <a pRipple class="flex items-center px-4 py-2 cursor-pointer group">
                    <i [class]="item.icon + ' text-primary group-hover:text-inherit'"></i>
                    <span class="ml-2">
                        {{ item.label }}
                    </span>
                    <i *ngIf="item.items" class="ml-auto pi pi-angle-down text-primary"></i>
                </a>
            </ng-template>
        </p-panelmenu>
        <div class="w-full mt-auto">
            <p-divider />
            <p-panelmenu [model]="bottomItems" [multiple]="true" styleClass="w-full md:w-20rem mt-5">
                <ng-template #item let-item>
                    <a pRipple class="flex items-center px-4 py-2 cursor-pointer group"
                        *ngIf="item.label === 'Sign Out'">
                        <i [class]="item.icon + ' text-primary group-hover:text-inherit'"></i>
                        <span class="ml-2">
                            {{ item.label }}
                        </span>
                        <i *ngIf="item.items" class="ml-auto pi pi-angle-down text-primary"></i>
                    </a>
                </ng-template>
            </p-panelmenu>
        </div>
    </div>
</p-drawer>

<p-dialog header="Opt for User" [position]="'top'" [modal]="true" [(visible)]="isOptDialogVisible"
    [style]="{ width: '35rem' }">
    <form [formGroup]="optUserForm" *ngIf="optUserForm">
        <div class="grid grid-cols-1 gap-3">
            <div class="flex flex-col col-span-full">
                <label mandatoryFieldLabel for="profileName">{{ 'PATIENT.PATIENT_NAME' | translate }}</label>
                <div class="mt-2">
                    <input pInputText type="text" name="profileName" id="profileName" formControlName="profileName"
                        class="w-full">
                </div>
            </div>
            <div class="flex flex-col col-span-full">
                <label for="mobileNumber" mandatoryFieldLabel>{{ 'ADDRESS.MOBILE_NUMBER' | translate }}</label>
                <div class="mt-2">
                    <p-inputgroup>
                        <p-inputgroup-addon>+91</p-inputgroup-addon>
                        <p-inputNumber phoneNumberMask inputId="mobileNumber" name="mobileNumber"
                            formControlName="mobileNumber" [maxlength]="10" [minlength]="10" class="w-full"
                            [useGrouping]="false" [placeholder]="'ADDRESS.ENTER_MOBILE' | translate">
                        </p-inputNumber>
                    </p-inputgroup>
                </div>
            </div>
            <div class="flex flex-col col-span-full">
                <label for="email" >{{ 'ADDRESS.EMAIL' | translate }}</label>
                <div class="mt-2">
                    <input pInputText id="email" name="email" type="email" class="w-full" formControlName="email"
                        [maxlength]="100" [placeholder]="'ADDRESS.ENTER_EMAIL' | translate">
                </div>
            </div>

            <div class="flex flex-col col-span-full">
                <label for="stillFamilyMember" mandatoryFieldLabel>{{ 'PATIENT.STILL_BE_FAMILY_MEMBER' | translate
                    }}</label>
                <div class="mt-2">
                    <p-selectbutton id="stillFamilyMember" formControlName="stillFamilyMember" [options]="yesNoOptions"
                        optionLabel="label" [allowEmpty]="false" optionValue="value"></p-selectbutton>
                </div>
            </div>
        </div>
    </form>
    <div class="flex justify-end gap-3 mt-5">
        <p-button label="Cancel" severity="secondary" (click)="isOptDialogVisible.set(false)" (keydown)="onCancelKeyDown($event)" />
        <p-button label="Apply" (onClick)="applyOptForUser()" />
    </div>
</p-dialog>


<p-confirmdialog key="opt-user" [position]="'top'" [draggable]="false" styleClass="opt-user w-[80vw] sm:w-[70vw] md:w-[35vw] lg:w-[28vw]"
>
    <ng-template #message let-message>
        <div class="flex flex-col w-full gap-1 pb-1 m-1 col-span-full" *ngIf="!isOTPSent">
            <span>{{ 'OTP_DIALOG.VERIFY_IDENTITY' | translate }}</span>
            <span>{{ `OTP_DIALOG.${optUserForm.get('email')?.value ? 'SEND_OTP_ON_BOTH' :'SEND_OTP_ON_MOBILE'}`
            | translate }}</span>
        </div>
        <div class="flex flex-col items-center w-full gap-4 m-1 col-span-full"
            *ngIf="isOTPSent">
          <span  class="w-full"
              [innerHTML]="optUserForm.get('email')?.value
                  ? ('OTP_DIALOG.OTP_SENT_BOTH' | translate:{ mobile: optUserForm.get('mobileNumber')?.value, email: optUserForm.get('email')?.value })
                  : ('OTP_DIALOG.OTP_SENT' | translate:{ contact: optUserForm.get('mobileNumber')?.value })">
            </span>
              <div class="flex  flex-col w-full" *ngIf="optUserForm.get('mobileNumber')?.value">
                <label for="smsOtp" class="font-bold" mandatoryFieldLabel>{{ 'OTP_DIALOG.MOBILE_OTP' | translate }}:</label>
                  <div class="mt-2">
                    <p-inputotp  id="smsOtp" [(ngModel)]="smsOtp" [size]="'small'" [integerOnly]="true" [length]="6"
                      [mask]="false" />
                  </div>
              </div>
              <div  class="flex flex-col w-full mt-3" *ngIf="optUserForm.get('email')?.value">
                <label for="emailOtp"  class="font-bold" mandatoryFieldLabel>{{ 'OTP_DIALOG.EMAIL_OTP' | translate }}:</label>
                <div class="mt-2">
                  <p-inputotp  id="emailOtp" [size]="'small'"  [(ngModel)]="emailOtp" [integerOnly]="true" [length]="6"
                      [mask]="false" />
                </div>
            </div>
            <span class="flex justify-start w-full">
                {{ 'OTP_DIALOG.RESEND_OTP_IN' | translate:{ time: formattedTime() } }}
            </span>
        </div>
    </ng-template>
    <ng-template #footer>
        <div class="flex items-center w-full gap-2" *ngIf="!isOTPSent">
            <p-button [label]="'OTP_DIALOG.SEND_OTP' | translate" class="w-full"
                [styleClass]="'w-full sm:w-full md:w-full lg:w-full'"
                (onClick)="resendOTP()" />

        </div>
        <div class="flex self-stretch justify-between w-full" *ngIf="isOTPSent">
            <p-button [label]="'OTP_DIALOG.RESEND_OTP' | translate" [link]="true" class="p-0" styleClass="pl-0"
                [disabled]="formattedTime() !== '00:00'" (onClick)="resendOTP()" />
            <p-button [label]="'OTP_DIALOG.SUBMIT' | translate" [disabled]="smsOtp?.length < 6 || (optUserForm.get('email')?.value && emailOtp?.length < 6 )"
                (onClick)="submitOTP()" />
        </div>
    </ng-template>
</p-confirmdialog>
