<div class="card">

    <div>
        <h4 class="text-base/7 font-semibold text-gray-900">{{ 'IMMUNIZATION.IMMUNIZATION' | translate }}</h4>
    </div>
    <p-divider />


    <ng-container>
        <p-table [value]="immunizationList" [reorderableColumns]="true" size="small" [paginator]="true"
            [rows]="rowsPerPage" [totalRecords]="immunizationList.length">


            <ng-template #body let-item let-index="rowIndex">
                <tr [pReorderableRow]="index">
                    <td>
                        <span class="pi pi-bars" pReorderableRowHandle></span>
                    </td>
                    <td>
                        <strong> {{item.immunizationName}} </strong>
                    </td>
                    <td>
                        {{ 'IMMUNIZATION.DOSE_NUMBER' | translate }} : {{ getDoseNumber(item.doseNumber) }} |
                        {{ 'IMMUNIZATION.DATE_OF_VACCINATION' | translate }} : {{ item.dateOfVaccination }} |
                        {{ 'IMMUNIZATION.ROUTE' | translate }} : {{ getRoute(item.routeId) }} |
                        {{ 'IMMUNIZATION.SITE' | translate }} : {{ getSite(item.siteId) }}
                        <!-- {{ 'IMMUNIZATION.STATUS' | translate }} : {{ getStatus(item.status) }} -->

                    </td>
                    <td style="width: 1%; text-align: right;">
                        <p-tag [severity]="getTagSeverity(item.status)" [value]="getStatus(item.status)"
                            [rounded]="true">
                        </p-tag>
                    </td>

                    <td class="flex justify-center gap-2">
                        <p-button icon="pi pi-pencil" variant="outlined" severity="info" [raised]="false"
                            (onClick)="editImmunization(item)" [rounded]="true" />
                        <!-- <p-button icon="pi pi-trash" variant="outlined" severity="danger" [raised]="false"
                            (onClick)="removeImmunization(index, item)" /> -->
                    </td>
                </tr>
            </ng-template>
            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="4">
                        <div class="text-center">
                            <span class="text-lg">{{'IMMUNIZATION.TABLE.EMPTY_MESSAGE' | translate}}</span>
                        </div>
                    </td>
                </tr>
            </ng-template>

        </p-table>
    </ng-container>

    <span *ngIf="appointmentId()">

        <div class="mt-5"></div>

        <p-autoComplete class="w-full" [style]="{width:'100%'}" id="vaccineName" [suggestions]="vaccineSuggestions"
            optionLabel="label" optionValue="value"
            placeholder="{{ 'IMMUNIZATION.PLACE_HOLDER.SEARCH_IMMUNIZATION' | translate }}" [dropdown]="false"
            minLength="3" maxLength="100" (onSelect)="addImmunization($event.value)"
            (completeMethod)="searchVaccine($event.query)" [inputStyle]="{ width: '100%' }" appendTo="body">
        </p-autoComplete>

        <div class="mt-5">
            <div class="flex flex-wrap gap-2">
                <button *ngFor="let vaccine of frequentlyUsedVaccines" type="button" pButton [rounded]="true"
                    class="p-button p-button-outlined" (click)="addImmunization(vaccine)">
                    {{ vaccine.label }}
                </button>
            </div>
        </div>
    </span>

</div>


<app-immunization-add-edit *ngIf="visible" [(isVisible)]="visible" [selectedImmunization]="selectedImmunization()"
    [appointmentId]="appointmentId()" [patientId]="patientId()"
    (onImmunizationUpdate)="loadImmunizations($event)"></app-immunization-add-edit>